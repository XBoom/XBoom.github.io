<!DOCTYPE html>
<html lang=en>
<head>
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?35ec0b872cf5aada9525fd9f0487c238";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta name="google-site-verification" content="BeKQvQ0pG-RjKgol5sz4Aa7m-FavwERwx31jVZUliWM" />
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Protocol-04-DHCP | Yuan Kang</title>
  <meta name="description" content="动态主机配置协议DHCP(Dynamic Host Configuration Protocol) 是一种网络管理协议，用于集中对用户 IP 地址进行动态管理和配置。 DHCP协议由 RFC 2131 定义，采用 Client &#x2F;服务器通信模式，由 客户端(DHCP Client) 向 **服务器(DHCP Server)**提出配置申请，Server为网络上的每个设备动态分配 IP 地址、子网掩">
<meta property="og:type" content="article">
<meta property="og:title" content="Protocol-04-DHCP">
<meta property="og:url" content="https://www.yuankang.top/2023/09/07/Protocol/Protocol-04-DHCP/index.html">
<meta property="og:site_name" content="XBoom Dove">
<meta property="og:description" content="动态主机配置协议DHCP(Dynamic Host Configuration Protocol) 是一种网络管理协议，用于集中对用户 IP 地址进行动态管理和配置。 DHCP协议由 RFC 2131 定义，采用 Client &#x2F;服务器通信模式，由 客户端(DHCP Client) 向 **服务器(DHCP Server)**提出配置申请，Server为网络上的每个设备动态分配 IP 地址、子网掩">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220000104.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220722271.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220805159.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230303654.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230549875.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230844722.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907231535947.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907231557794.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908224500248.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908224631147.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908230901387.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231042126.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231452273.png">
<meta property="og:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231606817.png">
<meta property="article:published_time" content="2023-09-07T02:25:38.000Z">
<meta property="article:modified_time" content="2023-09-08T15:38:23.323Z">
<meta property="article:author" content="XBoom Dove">
<meta property="article:tag" content="DHCP">
<meta property="article:tag" content="Protocol">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://www.yuankang.top/2023/09/07/Protocol/Protocol-04-DHCP/index.html">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="XBoom Dove" type="application/atom+xml">
</head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/XBoom" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Yuan Kang</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Learn and live</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/XBoom" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=728081687@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>Keep on going never give up!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms/">Algorithms</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms-To-Live-By/">Algorithms To Live By</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure/">Data Structure</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Design-Patterns/">Design Patterns</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-Transaction/">Distributed Transaction</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Grpc/">Grpc</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interesting-Algorithm/">Interesting Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MQ/">MQ</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Microservices/">Microservices</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Protocol/">Protocol</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unix-NetWork/">Unix NetWork</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/k8s/">k8s</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms/" rel="tag">Algorithms</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms-To-Live-By/" rel="tag">Algorithms To Live By</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Concurrency/" rel="tag">Concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DHCP/" rel="tag">DHCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Distributed-System/" rel="tag">Distributed System</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Distributed-Transaction/" rel="tag">Distributed Transaction</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ETCD/" rel="tag">ETCD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grpc/" rel="tag">Grpc</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap/" rel="tag">Heap</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Libevent/" rel="tag">Libevent</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/List/" rel="tag">List</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/" rel="tag">MQ</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory/" rel="tag">Memory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microservices/" rel="tag">Microservices</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql/" rel="tag">MySql</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PrimerPlus/" rel="tag">PrimerPlus</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protocol/" rel="tag">Protocol</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quic/" rel="tag">Quic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raft/" rel="tag">Raft</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix/" rel="tag">Unix</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unix-NetWork/" rel="tag">Unix NetWork</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 13.08px;">Algorithm</a> <a href="/tags/Algorithms/" style="font-size: 13.15px;">Algorithms</a> <a href="/tags/Algorithms-To-Live-By/" style="font-size: 13.38px;">Algorithms To Live By</a> <a href="/tags/C/" style="font-size: 13.85px;">C++</a> <a href="/tags/Concurrency/" style="font-size: 13px;">Concurrency</a> <a href="/tags/DHCP/" style="font-size: 13px;">DHCP</a> <a href="/tags/Data-Structure/" style="font-size: 13.08px;">Data Structure</a> <a href="/tags/Design-Patterns/" style="font-size: 13.92px;">Design Patterns</a> <a href="/tags/Distributed-System/" style="font-size: 13px;">Distributed System</a> <a href="/tags/Distributed-Transaction/" style="font-size: 13.46px;">Distributed Transaction</a> <a href="/tags/Docker/" style="font-size: 13px;">Docker</a> <a href="/tags/ETCD/" style="font-size: 13px;">ETCD</a> <a href="/tags/Go/" style="font-size: 14px;">Go</a> <a href="/tags/Grpc/" style="font-size: 13.69px;">Grpc</a> <a href="/tags/HTTP/" style="font-size: 13px;">HTTP</a> <a href="/tags/Heap/" style="font-size: 13.08px;">Heap</a> <a href="/tags/Kafka/" style="font-size: 13.23px;">Kafka</a> <a href="/tags/Libevent/" style="font-size: 13.08px;">Libevent</a> <a href="/tags/Linux/" style="font-size: 13.23px;">Linux</a> <a href="/tags/List/" style="font-size: 13px;">List</a> <a href="/tags/MQ/" style="font-size: 13.31px;">MQ</a> <a href="/tags/Memory/" style="font-size: 13px;">Memory</a> <a href="/tags/Microservices/" style="font-size: 13.62px;">Microservices</a> <a href="/tags/MySql/" style="font-size: 13.54px;">MySql</a> <a href="/tags/PrimerPlus/" style="font-size: 13.77px;">PrimerPlus</a> <a href="/tags/Protocol/" style="font-size: 13px;">Protocol</a> <a href="/tags/Quic/" style="font-size: 13px;">Quic</a> <a href="/tags/Raft/" style="font-size: 13px;">Raft</a> <a href="/tags/Redis/" style="font-size: 13.69px;">Redis</a> <a href="/tags/TCP-IP/" style="font-size: 13.31px;">TCP/IP</a> <a href="/tags/Unix/" style="font-size: 13.62px;">Unix</a> <a href="/tags/Unix-NetWork/" style="font-size: 13.62px;">Unix NetWork</a> <a href="/tags/k8s/" style="font-size: 13.31px;">k8s</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Unix-NetWork/">Unix NetWork</a>
              </p>
              <p class="item-title">
                <a href="/2024/02/07/Unix%20NetWork/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-12-IPC-FIFO/" class="title">TCPIP 网络编程-12-IPC-FIFO</a>
              </p>
              <p class="item-date">
                <time datetime="2024-02-07T15:00:00.000Z" itemprop="datePublished">2024-02-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Unix-NetWork/">Unix NetWork</a>
              </p>
              <p class="item-title">
                <a href="/2024/01/31/Unix%20NetWork/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-11-IPC-%E7%AE%A1%E9%81%93/" class="title">TCPIP 网络编程-11-进程间通信-管道</a>
              </p>
              <p class="item-date">
                <time datetime="2024-01-31T15:00:00.000Z" itemprop="datePublished">2024-01-31</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Unix-NetWork/">Unix NetWork</a>
              </p>
              <p class="item-title">
                <a href="/2024/01/25/Unix%20NetWork/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-09-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="title">TCPIP 网络编程-09-多进程服务器</a>
              </p>
              <p class="item-date">
                <time datetime="2024-01-25T15:00:00.000Z" itemprop="datePublished">2024-01-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Unix-NetWork/">Unix NetWork</a>
              </p>
              <p class="item-title">
                <a href="/2024/01/19/Unix%20NetWork/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-08-%E5%A5%97%E6%8E%A5%E5%AD%97%E9%80%89%E9%A1%B9/" class="title">TCPIP 网络编程-08-套接字选项</a>
              </p>
              <p class="item-date">
                <time datetime="2024-01-19T15:00:00.000Z" itemprop="datePublished">2024-01-19</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Unix-NetWork/">Unix NetWork</a>
              </p>
              <p class="item-title">
                <a href="/2024/01/14/Unix%20NetWork/TCPIP%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-07-%E5%9F%9F%E5%90%8D%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/" class="title">TCPIP 网络编程-07-域名地址转换</a>
              </p>
              <p class="item-date">
                <time datetime="2024-01-14T15:00:00.000Z" itemprop="datePublished">2024-01-14</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#dhcp好处"><span class="toc-number">1.</span> <span class="toc-text"> DHCP好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dhcp-工作原理"><span class="toc-number">2.</span> <span class="toc-text"> DHCP 工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#非中继"><span class="toc-number">2.1.</span> <span class="toc-text"> 非中继</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#中继"><span class="toc-number">2.2.</span> <span class="toc-text"> 中继</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#续租"><span class="toc-number">2.3.</span> <span class="toc-text"> 续租</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dhcp-报文"><span class="toc-number">3.</span> <span class="toc-text"> DHCP 报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#discover"><span class="toc-number">3.1.</span> <span class="toc-text"> Discover</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#offer"><span class="toc-number">3.2.</span> <span class="toc-text"> Offer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request"><span class="toc-number">3.3.</span> <span class="toc-text"> Request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ack"><span class="toc-number">3.4.</span> <span class="toc-text"> ACK</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dhcp-snooping"><span class="toc-number">4.</span> <span class="toc-text"> DHCP Snooping</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dhcp-攻击"><span class="toc-number">4.1.</span> <span class="toc-text"> DHCP 攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-dhcp-server仿冒者攻击"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 1. DHCP Server仿冒者攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-防止非dhcp用户攻击"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 2. 防止非DHCP用户攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-防止仿冒dhcp报文攻击"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 3. 防止仿冒DHCP报文攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-防止dhcp-server服务拒绝攻击"><span class="toc-number">4.1.4.</span> <span class="toc-text"> 4. 防止DHCP Server服务拒绝攻击</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-ldra功能感知用户位置信息"><span class="toc-number">4.1.5.</span> <span class="toc-text"> 5. LDRA功能感知用户位置信息</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#实现原理"><span class="toc-number">4.2.</span> <span class="toc-text"> 实现原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dhcpv6"><span class="toc-number">5.</span> <span class="toc-text"> DHCPv6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">6.</span> <span class="toc-text"> 参考链接</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-Protocol/Protocol-04-DHCP" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Protocol-04-DHCP
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2023/09/07/Protocol/Protocol-04-DHCP/" class="article-date">
	  <time datetime="2023-09-07T02:25:38.000Z" itemprop="datePublished">2023-09-07</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Protocol/">Protocol</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/DHCP/" rel="tag">DHCP</a>, <a class="article-tag-link" href="/tags/Protocol/" rel="tag">Protocol</a>
  </span>


        

	<span class="article-read hidden-xs">
    	<i class="icon icon-eye-fill" aria-hidden="true"></i>
    	<span id="/2023/09/07/Protocol/Protocol-04-DHCP/" class="leancloud_visitors"  data-flag-title="Protocol-04-DHCP">0</span>
    </span>

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2023/09/07/Protocol/Protocol-04-DHCP/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>动态主机配置协议<code>DHCP</code>(Dynamic Host Configuration Protocol) 是一种网络管理协议，用于集中对用户 IP 地址进行动态管理和配置。<br />
<strong>DHCP协议</strong>由 <code>RFC 2131</code> 定义，采用 Client /服务器通信模式，由 <strong>客户端(DHCP Client)</strong> 向 **服务器(DHCP Server)**提出配置申请，<strong>Server</strong>为网络上的每个设备动态分配 <strong>IP 地址</strong>、<strong>子网掩码</strong>、<strong>默认网关地址</strong>，<strong>域名服务器(DNS)地址</strong>等参数</p>
<p>相关协议(按时间从远到近排序) <a href="http://www.ietf.org/rfc/rfc1531.txt" target="_blank" rel="noopener">RFC1531</a> 、<a href="http://www.ietf.org/rfc/rfc1541.txt" target="_blank" rel="noopener">RFC1541</a>、<a href="http://www.ietf.org/rfc/rfc2131.txt" target="_blank" rel="noopener">RFC2131</a> 、<a href="http://www.ietf.org/rfc/rfc3396.txt" target="_blank" rel="noopener">RFC3396</a></p>
<h3 id="dhcp好处"><a class="markdownIt-Anchor" href="#dhcp好处"></a> DHCP好处</h3>
<p>网络中，每个连接Internet的设备都需要分配唯一的 IP。DHCP 使网络管理员能<strong>从中心结点监控和分配IP地址</strong>，从以下几个方面降低了配置和部署设备的时间</p>
<ul>
<li>减少 IP 地址冲突：每个连接的设备都必须有一个IP地址。但是，每个地址只能使用一次，重复的地址将导致无法连接一个或两个设备的冲突。</li>
<li>IP地址管理的自动化：如果没有 DHCP，网络管理员将需要手动分配和撤消地址。手动需要随时知道设备何时需要访问网络以及何时需要离开网络。</li>
<li>高效的变更管理：<strong>DHCP 的使用使更改地址，范围或端点变得非常简单</strong>。例如，组织可能希望将其IP寻址方案从一个范围更改为另一个范围。Server配置有新信息，该信息将传播到新端点。同样，如果升级并更换了网络设备，则不需要网络配置</li>
</ul>
<h3 id="dhcp-工作原理"><a class="markdownIt-Anchor" href="#dhcp-工作原理"></a> DHCP 工作原理</h3>
<p>DHCP 协议采用 <strong>UDP</strong> 作为传输协议，<strong>Client</strong> 发送请求消息到 <strong>Server</strong> 的 <strong>Port 67</strong>，<strong>Server</strong> 回应应答消息给 <strong>Client</strong> 的 <strong>Port 68</strong>，只有跟 Client 在同一个网段的 Server 才能收到 Client 广播的 <strong>DISCOVER报文</strong>。当 Client 与 Server 不在同一个网段时，必须部署DHCP中继来转发 Client 和Server之间的DHCP报文</p>
<h4 id="非中继"><a class="markdownIt-Anchor" href="#非中继"></a> 非中继</h4>
<p>在没有部署 <strong>DHCP中继</strong> 的场景下，首次接入网络 Client 与 Server 的报文交互过程，该过程称为<strong>DHCP报文四步交互</strong></p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download.png" alt="无中继场景时 Client 首次接入网络的报文交互示意图" /></p>
<p><strong>第一步：发现阶段</strong></p>
<p>首次接入网络的 Client 不知道 Server 的IP地址，为了学习到 Server 的IP地址，Client 以广播方式发送<strong>DISCOVER报文</strong>(目的IP地址为255.255.255.255)给同一网段内的所有设备(包括Server或中继)。<strong>DISCOVER报文</strong>中携带了 Client 的MAC地址等信息</p>
<p><strong>第二步：提供阶段</strong></p>
<p>与 Client 位于同一网段的 Server 都会接收到 <strong>DISCOVER报文</strong>，Server 选择跟接收 <strong>DISCOVER报文</strong>接口的IP地址处于同一网段的地址池，并且从中选择一个可用的IP地址，然后通过<strong>OFFER报文</strong>发送给Client，Server 在地址池中为 Client 分配IP地址的顺序如下：</p>
<ol>
<li>Server 上已配置的与 Client MAC地址静态绑定的 IP 地址。</li>
<li>Client 发送的 <strong>DISCOVER报文</strong>中 <code>Option50</code>(请求IP地址选项)指定的地址</li>
<li>地址池内查找 <code>Expired</code> 状态的IP地址，即曾经分配给 Client 的超过租期的IP地址</li>
<li>在地址池内随机查找一个 <code>Idle</code> 状态的IP地址。</li>
<li>如果未找到可供分配的 IP 地址，则地址池依次自动回收超过租期的 <code>Expired</code> 和处于冲突状态 <code>Conflict</code> 的IP地址。回收后如果找到可用的IP地址，则进行分配；否则，Client 等待应答超时后，重新发送<strong>DHCP DISCOVER报文</strong>来申请IP地址</li>
</ol>
<p>通常，<strong>Server</strong> 的地址池中会指定IP地址的租期，如果 <strong>Client</strong> 发送的 <strong>DISCOVER报文</strong> 中携带了期望租期，服务器会将 Client 请求的<strong>期望租期</strong>与其<strong>指定的租期</strong>进行比较，选择其中时间<strong>较短的租期</strong></p>
<p>为了防止分配出去的IP地址跟网络中其他 Client 的IP地址冲突，比如Client所在网段已经手工配置了一个地址池中的地址用于DNS服务器，Server 在发送<strong>DHCP OFFER报文</strong>前通过发送 Source IP = ServerIP地址、Target IP 为预分配出去IP地址的 <strong>ICMP ECHO REQUEST报文</strong> 对分配的IP地址进行地址冲突探测。</p>
<ul>
<li>如果在指定的时间内没有收到应答报文，表示网络中没有 Client 使用这个IP地址，可以分配给 Client ；</li>
<li>如果指定时间内收到应答报文，表示网络中已经存在使用此IP地址的 Client ，则把此地址列为冲突地址，然后等待重新接收到DHCP DISCOVER报文后重新选择（TODO 这个时间会不会很长，为什么不直接找一个IP地址分配）</li>
</ul>
<p>此阶段 Server 分配给 Client 的IP地址不一定是最终确定使用的IP地址，因为<strong>DHCP OFFER报文</strong>发送给 Client 等待<strong>16秒</strong> 后如果没有收到 Client 的响应，此地址就可以继续分配给其他 Client 。</p>
<p><strong>第三步：选择阶段</strong></p>
<p>在发现阶段 <code>DISCOVER报文</code> 是广播报文，也就是说有可能有多个 Server 向 Client 回应 <strong>DHCP OFFER报文</strong>，则 Client 一般只接收第一个收到的 DHCP OFFER报文，然后以<strong>广播方式</strong>发送 DHCP REQUEST报文，该报文中包含 Client 想选择的 Server标识符(即Option50，填充了接收的DHCP OFFER报文中<strong>yiaddr字段</strong>的IP地址)</p>
<p>Client 广播发送 DHCP REQUEST报文通知所有的Server，它将选择某个Server提供的IP地址，其他Server可以重新将曾经分配给 Client 的IP地址分配给其他 Client 。</p>
<blockquote>
<p>Server怎么判断这个报文是来请求自己分配出去的IP，还是 Client 用来告诉  Server 不用这个地址（两个DHCP 服务器分配的IP地址可能还都一样，不能通过IP判断是否是自己给的）？</p>
</blockquote>
<p><strong>第四步：确认阶段</strong></p>
<p>当Server收到 Client 发送的<strong>DHCP REQUEST报文</strong>后，Server回应 <strong>DHCP ACK报文</strong>，表示 <strong>DHCP REQUEST报文</strong> 中请求的IP地址(Option50 填充的)分配给 Client 使用。</p>
<ol>
<li>
<p>Client 收到 <strong>DHCP ACK报文</strong>，会广播发送免费<strong>ARP报文</strong>，探测本网段是否有其他终端使用服务器分配的IP地址</p>
<ul>
<li>
<p>如果在指定时间内没有收到回应，表示 Client 可以使用此地址。</p>
</li>
<li>
<p>如果收到了回应，说明有其他终端使用了此地址， Client 会向服务器发送 <strong>DHCP DECLINE报文</strong>，并重新向服务器请求IP地址，同时，服务器会将此地址列为<strong>冲突地址</strong>。当服务器没有空闲地址可分配时，再选择冲突地址进行分配，尽量减少分配出去的地址冲突</p>
<blockquote>
<p>DECLINE 是广播报文吗， 如果发送失败或者  Server无法分配其他地址呢？</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>当 Server 收到 Client 发送的 <strong>DHCP REQUEST报文</strong> 后，如果Client 由于某些原因（例如协商出错或者由于发送REQUEST过慢导致服务器已经把此地址分配给其他 Client )无法分配 <strong>DHCP REQUEST报文</strong>中 <code>Option50</code> 填充的IP地址，则发送<strong>DHCP NAK报文</strong>作为应答，通知 Client 无法分配此IP地址。** Client 需要重新发送DHCP DISCOVER报文来申请新的IP地址**</p>
</li>
</ol>
<h4 id="中继"><a class="markdownIt-Anchor" href="#中继"></a> 中继</h4>
<p>有DHCP中继的场景中，首次接入网络的 Client 和Server的工作原理与<strong>无中继场景时 Client 首次接入网络的工作原理</strong>相同。主要差异是DHCP中继在Server和 Client 之间转发DHCP报文，以保证Server和 Client 可以正常交互。在 Client 看来，DHCP中继就像Server；在Server看来，DHCP中继就像 Client</p>
<p>如下图所示，在部署DHCP中继的场景下，首次接入网络 Client 与Server的报文交互过程</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220000104.png" alt="有中继场景时 Client 首次接入网络的报文交互示意图" /></p>
<p><strong>第一步：发现阶段</strong></p>
<p>DHCP中继接收到 Client 广播发送的 DHCP DISCOVER报文后，进行如下处理：</p>
<ol>
<li>
<p>检查DHCP报文中的<code>hops</code>字段，<strong>如果大于16，则丢弃DHCP报</strong>文；否则，将<code>hops</code>字段加1(表明经过一次DHCP中继)，并继续下面的操作。</p>
</li>
<li>
<p>检查DHCP报文中的<code>giaddr</code>字段。如果是0，将<code>giaddr</code>字段设置为接收DHCP DISCOVER报文的接口IP地址。如果不是0，则不修改该字段，继续下面的操作。</p>
<blockquote>
<p>记录 <code>giaddr</code> 的目的就是在 DHCP 地址池中分配相同网段的 IP 地址</p>
</blockquote>
</li>
<li>
<p>将DHCP报文的目的IP地址改为<strong>Server或下一跳中继的IP地址</strong>，<strong>源地址改为中继连接 Client 的接口地址</strong>，通过路由转发将DHCP报文<strong>单播</strong>发送到Server或下一跳中继</p>
</li>
</ol>
<p>如果 Client 与Server之间存在多个DHCP中继，后面的中继接收到DHCP DISCOVER报文的处理流程同前面所述</p>
<p><strong>第二步：提供阶段</strong></p>
<p>Server接收到DHCP DISCOVER报文后，<strong>选择与报文中<code>giaddr</code>字段为同一网段的地址池</strong>，并为 Client 分配IP地址等参数，然后向<code>giaddr</code>字段标识的DHCP中继单播发送DHCP OFFER报文。</p>
<p>DHCP中继收到DHCP OFFER报文后，会进行如下处理：</p>
<ol>
<li>
<p>检查报文中的<code>giaddr</code>字段，<strong>如果不是接口的地址，则丢弃该报文</strong>；否则，继续下面的操作。</p>
<blockquote>
<p>DHCP 服务器怎么知道是不是中继过来的？通过 hops 吗？</p>
</blockquote>
</li>
<li>
<p>DHCP中继检查报文的<strong>广播标志位</strong>。如果广播标志位为1，则将DHCP OFFER报文广播发送给 Client ；否则将DHCP OFFER报文单播发送给 Client 。</p>
<blockquote>
<p>广播标志位是什么时候设置的？</p>
<p>为什么 DHCP OFFER 需要官博发送给 DHCP  Client</p>
</blockquote>
</li>
</ol>
<p><strong>第三步：选择阶段</strong></p>
<p>中继接收到来自 Client 的DHCP REQUEST报文的处理过程同无中继场景下的选择阶段。</p>
<p><strong>第四步：确认阶段</strong></p>
<p>中继接收到来自服务器的DHCP ACK报文的处理过程同无中继场景下的确认阶段。</p>
<h4 id="续租"><a class="markdownIt-Anchor" href="#续租"></a> 续租</h4>
<p>DHCP提供了两种地址分配机制，可以根据网络需求为不同的主机选择不同的分配策略。</p>
<ul>
<li>动态分配机制：通过DHCP为主机分配一个有使用期限的IP地址</li>
<li>静态分配机制：网络管理员通过DHCP为指定的主机分配固定的IP地址。</li>
</ul>
<p>Client 向 Server 申请地址时可以携带期望租期，将分配租期与期望租期比较，**分配其中一个较短的租期给 Client **。租期到期或者 Client 下线释放地址后，服务器会收回该IP地址，收回的IP地址可以继续分配给其他 Client 使用。这种机制可以提高IP地址的利用率，避免 Client 下线后IP地址继续被占用。如果 Client 希望继续使用该地址，需要更新IP地址的租期(如延长IP地址租期)，更新租期过程如下</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220722271.png" alt=" Client 更新租期示意图" /></p>
<ol>
<li>当租期达到<strong>50%(T1)<strong>时，Client 会自动以</strong>单播</strong>的方式向 Server 发送 <strong>DHCP REQUEST报文</strong>，请求更新IP地址租期
<ul>
<li>如果收到 Server 回应的 <strong>DHCP ACK报文</strong>，则租期更新成功(即租期从0开始计算)；</li>
<li>如果收到 <strong>DHCP NAK报文</strong>，则重新发送 <strong>DHCP DISCOVER报文</strong>请求新的IP地址。</li>
</ul>
</li>
<li>当租期达到<strong>87.5%(T2)<strong>时，如果仍未收到Server的应答，Client 会自动以</strong>广播</strong>的方式向 Server 发送 <strong>DHCP REQUEST报文</strong>，请求更新IP地址租期。后续处理逻辑同上</li>
<li>如果租期时间到时都没有收到服务器的回应， Client 停止使用此IP地址，重新发送DHCP DISCOVER报文请求新的IP地址。</li>
</ol>
<p>Client 在租期时间到之前，如果不想使用分配的IP地址(例如 Client 网络位置需要变更)，会触发 Client 向 Server 发送 <strong>DHCP RELEASE报文</strong>，通知 Server 释放IP地址的租期。Server 会保留这个 Client 的配置信息，将IP地址列为曾经分配过的IP地址中，以便后续重新分配给该 Client 或其他 Client 。 Client 可以通过发送 <strong>DHCP INFORM报文</strong>向服务器请求更新配置信息</p>
<p>部署DHCP中继时，更新租期的过程与上述过程相似。</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230907220805159.png" alt=" Client 通过DHCP中继更新租期示意图" /></p>
<p>**如果不是首次呢，比如客户端重启了 ？**如果客户端重启后，会自动发送 <strong>DHCP REQUEST广播</strong> 给 Server 以便请求继续租用原来使用的IP地址，</p>
<ul>
<li>如果服务器收到这个消息，确认客户端可以使用该地址，则回答一个<strong>DHCP ACK</strong>确认消息</li>
<li>如果此IP地址已经无法再分配，则返回一个 <strong>DHCP NCK</strong>否认信息，客户端收到这个信息以后，则必须重新发送 DHCP Discovery消息获取新的地址(启动首次登录的流程)。 <strong>若没有得到响应，则尝试与网关通信，如果通信正常，这个租期还没到期的话，则可以继续使用，但是不能和网关通信的话，则会获得169.254.0.1~169.254.255.254之间的IP地址，然后每隔5min尝试更新租约</strong></li>
</ul>
<h3 id="dhcp-报文"><a class="markdownIt-Anchor" href="#dhcp-报文"></a> DHCP 报文</h3>
<p>Server 与 Client 之间通过DHCP报文进行通信。DHCP报文是基于UDP协议传输的。Client 使用的端口号为68，Server 使用的端口号为67。目前DHCP定义了如下八种类型报文，<strong>每种报文的格式相同，只是某些字段的取值不同</strong></p>
<table>
<thead>
<tr>
<th>报文名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>DHCP DISCOVER</td>
<td>Client 首次登录网络时进行DHCP交互过程发送的第一个报文，用来寻找Server。</td>
</tr>
<tr>
<td>DHCP OFFER</td>
<td>Server用来响应<strong>DHCP DISCOVER报文</strong>，此报文携带了各种配置信息。</td>
</tr>
<tr>
<td>DHCP REQUEST</td>
<td>此报文用于以下三种用途。<br />1.  Client 初始化后，发送广播的 <strong>DHCP REQUEST报文</strong>来回应服务器的<strong>DHCP OFFER报文</strong>。<br />2.  Client 重启后，发送广播的 <strong>DHCP REQUEST报文</strong>来确认先前被分配的IP地址等配置信息。<br />3. 当 Client 已经和某个IP地址绑定后，发送 <strong>DHCP REQUEST单播或广播报文</strong>来更新IP地址的租约。</td>
</tr>
<tr>
<td>DHCP ACK</td>
<td>Server 对 Client 的<strong>DHCP REQUEST报文</strong>的确认响应报文，Client收到此报文后，才真正获得了IP地址和相关的配置信息。</td>
</tr>
<tr>
<td>DHCP NAK</td>
<td>服务器对Client 的<strong>DHCP REQUEST报文</strong>的拒绝响应报文，例如Server收到DHCP REQUEST报文后，没有找到相应的租约记录，则发送DHCP NAK 报文作为应答，告知 Client 无法分配合适IP地址。</td>
</tr>
<tr>
<td>DHCP DECLINE</td>
<td>当 Client 发现服务器分配给它的IP地址发生冲突时会通过发送此报文来通知服务器，并且会重新向服务器申请地址。</td>
</tr>
<tr>
<td>DHCP RELEASE</td>
<td>Client 可通过发送此报文主动释放服务器分配给它的IP地址，当服务器收到此报文后，可将这个IP地址分配给其它的 Client 。</td>
</tr>
<tr>
<td>DHCP INFORM</td>
<td>Client 获取IP地址后，如果需要向Server获取更为详细的配置信息(网关地址、DNS服务器地址)，则向Server发送DHCP INFORM请求报文。</td>
</tr>
</tbody>
</table>
<p>报文地址：<a href="https://wiki.wireshark.org/uploads/__moin_import__/attachments/Development/PcapNg/dhcp.pcapng" target="_blank" rel="noopener">https://wiki.wireshark.org/uploads/__moin_import__/attachments/Development/PcapNg/dhcp.pcapng</a></p>
<p>DHCP 四步交互如下</p>
<img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230303654.png" alt="image-20230907230303654" style="zoom:80%;" />
<p>服务端的端口是 67，客户端的端口是 68</p>
<p>这里有一个疑问就是 192.168.0.10 是从哪里来的，DHCP 服务器分配之后直接写进去了</p>
<h4 id="discover"><a class="markdownIt-Anchor" href="#discover"></a> Discover</h4>
<img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230549875.png" alt="image-20230907230549875" style="zoom:50%;" />
<p>DHCP 报文格式一样，只是最后的 Option 不同，前面包含的字段如下：</p>
<ul>
<li><strong>Message type</strong>：报文的操作类型。分为请求报文和响应报文，1为请求报文，2为响应报文。具体报文类型在option字段中标识</li>
<li><strong>Hardware type</strong>：DHCP客户端的硬件地址类型。1表示ethernet地址</li>
<li><strong>Hardeare address length</strong>：DHCP客户端的硬件地址长度。Ethernet地址为6</li>
<li><strong>Hops</strong>：DHCP报文经过的DHCP中继的数目。初始为0，报文每经过一个DHCP中继，该字段就会增加1</li>
<li><strong>Transaction ID</strong>: 客户端发起一次请求时选择的随机数，用来标识一次地址请求过程</li>
<li><strong>Seconds elapsed</strong>: Client 开始DHCP请求后所经过的时间。目前尚未使用，固定取0</li>
<li><strong>Bootp flags</strong>：DHCP服务器响应报文是采用单播还是广播方式发送。<strong>只使用第0比特位，0表示采用单播方式，1表示采用广播方式</strong>，其余比特保留不用</li>
<li><strong>Client IP address</strong>: DHCP客户端的IP地址</li>
<li><strong>Your(client) IP address</strong>: DHCP服务器分配给客户端的IP地址</li>
<li><strong>Next server IP address</strong>：DHCP客户端获取IP地址等信息的服务器IP地址</li>
<li><strong>Relay agent IP address</strong>: DHCP客户端发出请求报文后经过的第一个DHCP中继的IP地址</li>
<li><strong>Client MAC address</strong>: DHCP客户端的硬件地址</li>
<li><strong>Server host name</strong>: DHCP客户端获取IP地址等信息的服务器名称</li>
<li><strong>Boot file name</strong>: DHCP服务器为DHCP客户端指定的启动配置文件名称及路径信息</li>
<li><strong>Magic cookie</strong>: 标识和解释DHCP消息的元素，有助于确保不同设备之间的协议兼容性，并提供了消息类型和选项格式的关键信息</li>
<li><strong>Option</strong>：可选变长选项字段，包含报文的类型、有效租期、DNS服务器的IP地址和WINS服务器的IP地址等配置信息。</li>
</ul>
<p>因为是广播报文，所以目的地址是 <code>255.255.255.255</code>，其中</p>
<ul>
<li>Option(53): 表示 DHCP 消息类型，Discover(1)</li>
<li>Option(50): 用来记录请求的 IP</li>
<li>Option(55): 用来请求其他参数</li>
<li>Option(61): 客户端标识符</li>
</ul>
<h4 id="offer"><a class="markdownIt-Anchor" href="#offer"></a> Offer</h4>
<img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907230844722.png" alt="image-20230907230844722" style="zoom:50%;" />
<p>这里也包含了很多 Option:</p>
<ul>
<li>Option(53): DHCP 消息类型，Offer(2)</li>
<li>Option(1): 子网掩码， <code>255.255.255.0</code></li>
<li>Option(58): 续租时间 T1，一般为租期的 50%</li>
<li>Option(59): 重新发起T2, 租约响应超时，重新发起广播时间，一般位租期的 87.5%</li>
<li>Option(51): 租约</li>
<li>Option(54): DHCP服务器标识符选项</li>
</ul>
<h4 id="request"><a class="markdownIt-Anchor" href="#request"></a> Request</h4>
<img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907231535947.png" alt="image-20230907231535947" style="zoom:50%;" />
<p>这里也包含了很多 Option:</p>
<ul>
<li>Option(53): DHCP 消息类型，Request(3)</li>
<li>Option(61): 客户段标识</li>
<li>Option(50):  请求的 IP</li>
<li>Option(54):  服务端标识</li>
<li>Option(55): 请求的参数</li>
</ul>
<h4 id="ack"><a class="markdownIt-Anchor" href="#ack"></a> ACK</h4>
<img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/image-20230907231557794.png" alt="image-20230907231557794" style="zoom:50%;" />
<p>这里也包含了很多 Option:</p>
<ul>
<li>Option(53): DHCP 消息类型，Ack(5)</li>
<li>Option(1): 子网掩码， <code>255.255.255.0</code></li>
<li>Option(58): 续租时间 T1，一般为租期的 50%</li>
<li>Option(59): 重新发起T2, 租约响应超时，重新发起广播时间，一般位租期的 87.5%</li>
<li>Option(51): 租约</li>
<li>Option(54): DHCP服务器标识符选项</li>
</ul>
<h3 id="dhcp-snooping"><a class="markdownIt-Anchor" href="#dhcp-snooping"></a> DHCP Snooping</h3>
<p>DHCP Snooping 是DHCP的一种安全特性，用于保证 DHCP客户端从合法的 DHCP服务器获取IP地址，并记录DHCP客户端IP地址与MAC地址等参数的对应关系。<code>DHCP Snooping</code> 用来抵御网络中针对DHCP的各种攻击</p>
<blockquote>
<ol>
<li>DHCP攻击有哪些</li>
<li>它的原理是什么</li>
</ol>
</blockquote>
<h4 id="dhcp-攻击"><a class="markdownIt-Anchor" href="#dhcp-攻击"></a> DHCP 攻击</h4>
<h5 id="1-dhcp-server仿冒者攻击"><a class="markdownIt-Anchor" href="#1-dhcp-server仿冒者攻击"></a> 1. DHCP Server仿冒者攻击</h5>
<p>由于 Server 和 Client 之间没有认证机制，而 DHCP Discover报文 是以<strong>广播</strong>形式发送，如果在网络上随意添加一台 DHCP服务器，它就可以为 Client 分配IP地址以及其他网络参数。</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908224500248.png" alt="DHCP Client发送DHCP Discover报文示意图" /></p>
<p>如果此时 DHCP Server仿冒者 回应给 Client 仿冒信息，如错误的网关地址、错误的DNS(Domain Name System)服务器、错误的IP等信息。Client 将无法获取正确的IP地址和相关信息，导致合法客户无法正常访问网络或信息安全受到严重威胁。</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download.png" alt="img" /></p>
<p>解决办法：为了防止DHCP Server仿冒者攻击，可配置设备接口的 <code>信任(Trusted)/非信任(Untrusted)</code>工作模式</p>
<p>将与合法DHCP服务器直接或间接连接的接口设置为信任接口，其他接口设置为非信任接口。此后，从<code>非信任(Untrusted)</code>接口上收到的DHCP回应报文将被直接丢弃，这样可以有效防止DHCP Server仿冒者的攻击</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908224631147.png" alt="img" /></p>
<h5 id="2-防止非dhcp用户攻击"><a class="markdownIt-Anchor" href="#2-防止非dhcp用户攻击"></a> 2. 防止非DHCP用户攻击</h5>
<p>在DHCP网络中，静态获取IP地址的用户（非DHCP用户）对网络可能存在多种攻击，譬如仿冒DHCP Server、构造虚假DHCP Request报文等。这将为合法DHCP用户正常使用网络带来了一定的安全隐患</p>
<p>解决办法：开启设备根据 <strong>DHCP Snooping绑定表</strong> 生成接口的静态MAC表项功能，设备将根据接口下所有的DHCP用户对应的DHCP Snooping绑定表项自动执行命令生成这些用户的静态MAC表项，并同时关闭接口学习动态MAC表项的能力。此时，只有源MAC与静态MAC表项匹配的报文才能够通过该接口，否则报文会被丢弃。因此对于该接口下的非DHCP用户，只有管理员手动配置了此类用户的静态MAC表项其报文才能通过，否则报文将被丢弃。</p>
<p><strong>动态MAC表项是设备自动学习并生成的，静态MAC表项则是根据命令配置而成的</strong>。MAC表项中包含用户的MAC、所属VLAN、连接的接口号等信息，设备可根据MAC表项对报文进行二层转发</p>
<h5 id="3-防止仿冒dhcp报文攻击"><a class="markdownIt-Anchor" href="#3-防止仿冒dhcp报文攻击"></a> 3. 防止仿冒DHCP报文攻击</h5>
<p>已获取到IP地址的合法用户通过向服务器发送 DHCP Request 或 DHCP Release 报文用以续租或释放IP地址。</p>
<ul>
<li>如果攻击者冒充合法用户不断向DHCP Server发送DHCP Request报文来续租IP地址，会导致这些到期的IP地址无法正常回收，以致一些合法用户不能获得IP地址；</li>
<li>而若攻击者仿冒合法用户的DHCP Release报文发往DHCP Server，将会导致用户异常下线</li>
</ul>
<p>解决办法：利用DHCP Snooping绑定表的功能。设备通过将DHCP Request续租报文和DHCP Release报文与绑定表进行匹配操作能够有效的判别报文是否合法(主要是检查报文中的VLAN、IP、MAC、接口信息是否匹配动态绑定表)，若匹配成功则转发该报文，匹配不成功则丢弃</p>
<h5 id="4-防止dhcp-server服务拒绝攻击"><a class="markdownIt-Anchor" href="#4-防止dhcp-server服务拒绝攻击"></a> 4. 防止DHCP Server服务拒绝攻击</h5>
<p>若设备接口if1 下存在大量攻击者恶意申请IP地址，会导致DHCP Server中IP地址快速耗尽而不能为其他合法用户提供IP地址分配服务。</p>
<p>另一方面，DHCP Server通常仅根据DHCP Request报文中的(Client Hardware Address)字段来确认客户端的MAC地址。如果某一攻击者通过不断改变<strong>CHADDR字段</strong>向DHCP Server申请IP地址，同样将会导致DHCP Server上的地址池被耗尽，从而无法为其他正常用户提供IP地址</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908230901387.png" alt="img" /></p>
<p>解决办法：</p>
<ul>
<li>
<p>为了抑制大量 Client 恶意申请IP地址，在使能设备的DHCP Snooping功能后，可配置设备或接口允许接入的最大DHCP用户数，当接入的用户数达到该值时，则不再允许任何用户通过此设备或接口成功申请到IP地址。</p>
</li>
<li>
<p>通过改变DHCP Request报文中的CHADDR字段方式的攻击，可使能设备检测DHCP Request报文帧头MAC与DHCP数据区中<code>CHADDR</code>字段是否一致功能，此后设备将检查上送的DHCP Request报文中的帧头MAC地址是否与<strong>CHADDR值</strong>相等</p>
</li>
</ul>
<h5 id="5-ldra功能感知用户位置信息"><a class="markdownIt-Anchor" href="#5-ldra功能感知用户位置信息"></a> 5. LDRA功能感知用户位置信息</h5>
<p><strong>LDRA</strong>称为轻量级DHCPv6中继代理，该<strong>中继代理能够记录用户位置信息</strong>并将其发送到 DHCPv6 Server，从而使得DHCPv6 Server能够获取到用户详细的物理位置信息，以实现对用户客户端部署诸如地址分配、计费、接入控制等策略</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231042126.png" alt="LDRA应用组网图" /></p>
<p>解决办法：在使能Switch的DHCP Snooping功能之后，可使能其LDRA功能。Switch既能够获取用户详细的位置信息并将其发送到DHCPv6 Server。DHCPv6 Server即可根据用户的详细位置信息为其部署地址分配策略或其他安全策略</p>
<p>LDRA功能仅是记录了DHCPv6用户的详细位置信息并通过 RELAY-FORW报文 将该信息发送给DHCPv6 Server，对不同的用户部署诸如地址分配、计费、接入控制等策略，由DHCPv6 Server实现</p>
<h4 id="实现原理"><a class="markdownIt-Anchor" href="#实现原理"></a> 实现原理</h4>
<p>DHCP Snooping分为DHCPv4 Snooping和DHCPv6 Snooping，两者实现原理相似。开启 DHCP Snooping 的接口会根据 DHCP 请求与响应生成 DHCP Snoop 绑定表，后续设备再从盖接口接受用户发送的 DHCP 报文时，会进行匹配检查</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231452273.png" alt="img" /></p>
<p>如下图所示的DHCP场景中，连接在二层接入设备上的PC配置为自动获取IP地址。PC作为DHCP客户端通过广播形式发送DHCP请求报文，使能了DHCP Snooping功能的二层接入设备将其通过信任接口转发给DHCP服务器。最后DHCP服务器将含有IP地址信息的DHCP ACK报文通过单播的方式发送给PC。在这个过程中，二层接入设备收到DHCP ACK报文后，会从该报文中提取关键信息（包括PC的MAC地址以及获取到的IP地址、地址租期），并获取与PC连接的使能了DHCP Snooping功能的接口信息（包括接口编号及该接口所属的VLAN，根据这些信息生成DHCP Snooping绑定表。</p>
<p><img src="https://images-1307117474.cos.ap-guangzhou.myqcloud.com/blogs/Blog_3/download-20230908231606817.png" alt="img" /></p>
<p><strong>DHCP Snooping绑定表 根据DHCP租期进行老化或根据用户释放IP地址时发出的DHCP Release报文自动删除对应表项</strong></p>
<p>由于DHCP Snooping绑定表记录了DHCP客户端IP地址与MAC地址等参数的对应关系，故通过对报文与DHCP Snooping绑定表进行匹配检查，能够有效防范非法用户的攻击。</p>
<p>为了保证设备在生成DHCP Snooping绑定表时能够获取到用户MAC等参数，DHCP Snooping功能<strong>需应用于二层网络中的接入设备或第一个DHCP Relay上</strong>。</p>
<p>在DHCP中继使能DHCP Snooping场景中，<strong>DHCP Relay设备不需要设置信任接口</strong>。因为DHCP Relay收到DHCP请求报文后进行源目的IP、MAC转换处理，然后以单播形式发送给指定的合法DHCP服务器，所以DHCP Relay收到的DHCP ACK报文都是合法的，生成的DHCP Snooping绑定表也是正确的</p>
<p><strong>总结来说，是有一个 DHCP Snooping 绑定表用来记录以及校验 DHCP 报文</strong>，另外还有校验 二层 MAC 地址与 DHCP 的 <code>Client mac address</code> 的功能</p>
<h3 id="dhcpv6"><a class="markdownIt-Anchor" href="#dhcpv6"></a> DHCPv6</h3>
<p><code>546</code>号端口用于 <code>DHCPv6 Client</code>，而不用于DHCPv4，是为<code>DHCP failover</code>服务，这是需要特别开启的服务，<code>DHCP failover</code>是用来做<code>双机热备</code>的</p>
<h3 id="参考链接"><a class="markdownIt-Anchor" href="#参考链接"></a> 参考链接</h3>
<ol>
<li><a href="https://info.support.huawei.com/info-finder/encyclopedia/zh/DHCP.html" target="_blank" rel="noopener">https://info.support.huawei.com/info-finder/encyclopedia/zh/DHCP.html</a></li>
<li><a href="https://support.huawei.com/hedex/hdx.do?docid=EDOC1100087046&amp;id=ZH-CN_CONCEPT_0176371515" target="_blank" rel="noopener">https://support.huawei.com/hedex/hdx.do?docid=EDOC1100087046&amp;id=ZH-CN_CONCEPT_0176371515</a></li>
<li><a href="https://support.huawei.com/hedex/hdx.do?docid=EDOC1100087046&amp;id=ZH-CN_CONCEPT_0176371535" target="_blank" rel="noopener">https://support.huawei.com/hedex/hdx.do?docid=EDOC1100087046&amp;id=ZH-CN_CONCEPT_0176371535</a></li>
<li><a href="https://info.support.huawei.com/info-finder/encyclopedia/zh/ICMP.html" target="_blank" rel="noopener">https://info.support.huawei.com/info-finder/encyclopedia/zh/ICMP.html</a></li>
<li><a href="https://wiki.wireshark.org/DHCP.md" target="_blank" rel="noopener">https://wiki.wireshark.org/DHCP.md</a></li>
<li><a href="https://info.support.huawei.com/info-finder/encyclopedia/zh/DHCP+Snooping.html" target="_blank" rel="noopener">https://info.support.huawei.com/info-finder/encyclopedia/zh/DHCP+Snooping.html</a></li>
</ol>

      
    </div>
    <div class="article-footer">
      <!--
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://www.yuankang.top/2023/09/07/Protocol/Protocol-04-DHCP/" title="Protocol-04-DHCP" target="_blank" rel="external">https://www.yuankang.top/2023/09/07/Protocol/Protocol-04-DHCP/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/XBoom" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/XBoom" target="_blank"><span class="text-dark">Yuan Kang</span><small class="ml-1x">Learn and live</small></a></h3>
        <div>Talk is cheap, Show me your code</div>
      </div>
    </figure>
  </div>
</div>


      -->
    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2023/09/18/Data%20Structure/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-01-List/" title="数据结构-01-List"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2023/07/15/Go/Go-27-SyncPool/" title="Go-27-SyncPool"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">    <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/XBoom" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=728081687@qq.com" target="_blank" title="Email" data-toggle=tooltip data-placement=top><i class="icon icon-email"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <!--
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
        -->
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   


<!-- custom analytics part create by xiamo -->
<script defer src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
<script defer>
AV.init({
  appId: 'SbGHqy6xigse8A1P9rctla9N-gzGzoHsz',
  appKey: 'Yjv3BxtjwA5IStDccnVj1eQr'
});

function showTime(Counter) {
	var query = new AV.Query(Counter);
		var visitors= $('.leancloud_visitors');
		query.greaterThanOrEqualTo("time", 0);		
		query.find({
			success: function(results) {
				if (results.length == 0) {				
					return;
				}
				var data = results;
				visitors.each(function(){
					var url = $(this).attr('id').trim();					
					for (var i = 0; i < data.length; i++) {
						var object = data[i];
						var content = object.get('time');
						var _url = object.get('url')
						if(url == _url){
							$(this).text(content);
						}
					}
				})
				
			},
			error: function(object, error) {
				console.log("Error: " + error.code + " " + error.message);
			}
		});
}

function addCount(Counter) {
	var Counter = AV.Object.extend("Counter");
	url = $(".leancloud_visitors").attr('id').trim();
	title = $(".leancloud_visitors").attr('data-flag-title').trim();
	var query = new AV.Query(Counter);
	query.equalTo("url", url);
	query.find({
		success: function(results) {
			if (results.length > 0) {
				var counter = results[0];
				counter.fetchWhenSave(true);
				counter.increment("time");
				counter.save(null, {
					success: function(counter) {
						var content = counter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(counter, error) {
						console.log('Failed to save Visitor num, with error message: ' + error.message);
					}
				});
			} else {
				var newcounter = new Counter();
				newcounter.set("title", title);
				newcounter.set("url", url);
				newcounter.set("time", 1);
				newcounter.save(null, {
					success: function(newcounter) {
					    console.log("newcounter.get('time')="+newcounter.get('time'));
						var content = newcounter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(newcounter, error) {
						console.log('Failed to create');
					}
				});
			}
		},
		error: function(error) {
			console.log('Error:' + error.code + " " + error.message);
		}
	});
}
$(function() {
	var Counter = AV.Object.extend("Counter");
	if ($('.leancloud_visitors').length == 1) {
		addCount(Counter);
	} else {
		showTime(Counter);
	}
}); 
</script>



   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'SbGHqy6xigse8A1P9rctla9N-gzGzoHsz',
    appKey: 'Yjv3BxtjwA5IStDccnVj1eQr',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     






    <script defer>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?35ec0b872cf5aada9525fd9f0487c238";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>



</body>
</html>